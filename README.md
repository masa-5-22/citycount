# Citycount 到達指数ダッシュボード

ブラウザで開くだけで利用できる、世界の国・日本の都道府県・日本の市区町村の旅行接触度（0〜10 点）を記録するツールです。地図や一覧から地域を選び、滞在状況を入力すると推奨スコアが自動で表示されます。

## 機能概要

- **世界**: 249 の国・地域（ISO 3166-1 基準）を収録。MapLibre GL ベースの世界地図で国境ポリゴンをスコアに応じた色で塗り分け、クリックすると入力ダイアログが開きます。
- **日本の都道府県**: MapLibre 上で都道府県境界ポリゴンを読み込み、スコアを 0〜10 のグラデーションで表示。地図と一覧のどちらからでも編集できます。
- **日本の市区町村**: 国土地理院の市区町村ポリゴンを参照して描画。サンプル 60 件に加えて CSV/JSON インポートで拡張でき、地図上をクリックすると該当自治体を自動認識して編集ダイアログを開きます。
- **スコア判定支援**: yearsLived や totalNights などを入力すると推奨スコアを即座に計算。最終スコアは 0〜10 の整数で上書きできます。
- **スコア可視化**: 一覧やダイアログに 0〜10 点のカラーメーターとラベル付きチップを表示し、現在値と推奨値の違いを直感的に把握できます。
- **永続化**: 入力内容はブラウザの `localStorage` に自動保存され、次回以降も引き継がれます。
- **CSV エクスポート**: 各セクションごとに CSV を出力可能。滞在日数やメモも一緒に出力されます。

## 使い方

1. プロジェクトをクローン/ダウンロードし、`index.html` をブラウザで開きます。
2. 上部タブから「世界」「日本の都道府県」「日本の市区町村」を切り替えられます。
3. マップ上の領域（国・都道府県・市区町村）または一覧行をクリック/Enter キーで編集ダイアログを開きます。
4. ダイアログで滞在実績を入力すると推奨スコアが表示されます。内容を確認し「保存」を押してください。
5. 右上の「CSV エクスポート」で現在のスコアをダウンロードできます。
6. 市区町村を追加する場合は地図上をクリックするか、CSV/JSON をインポートしてください（クリック時は最寄りポリゴンから自治体を推定します）。

## 公開方法（HP・アプリ化への第一歩）

本プロジェクトは完全な静的アプリケーションとして動作します。`index.html`・`styles.css`・`app.js` と `data/` 以下の GeoJSON を同じディレクトリに置くだけで完結するため、以下のような方法で簡単に公開できます。

### ローカルでの確認

- `index.html` を直接ブラウザで開く（最も手軽な方法）。
- もしくは `python -m http.server 8000` などの簡易サーバーを立ち上げ、`http://localhost:8000` にアクセスすると、ファイル構成を変えずに本番と同じ URL 体系で確認できます。

### 静的ホスティングサービスに配置する

| サービス | 手順概要 |
| --- | --- |
| GitHub Pages | リポジトリを GitHub に push → Repository Settings → Pages で `main` ブランチを公開。必要に応じて `docs/` フォルダにファイルを置く。 |
| Vercel / Netlify / Cloudflare Pages | GitHub リポジトリをインポートし、ビルド設定をスキップ（`index.html` をそのまま配信）。デプロイ後は自動で HTTPS 対応の URL が発行され、独自ドメインも設定できます。 |
| Render (Static Site) | Dashboard → New → Static Site からこのリポジトリを選択し、Build Command を空欄、Publish Directory を `/` に設定してデプロイ。 |

いずれのサービスでも追加の API キーや専用サーバー構築は不要です。MapLibre GL のスタイル（`https://demotiles.maplibre.org/style.json`）は公開 URL を参照しており、無料で利用できます。

### 継続的な記録・ランキングを行いたい場合

- ブラウザ `localStorage` では端末ごとにデータが分かれるため、ユーザー単位の記録を共有したい場合はバックエンドを用意します。Supabase や Firebase、あるいは自前の REST API（例: FastAPI、Next.js API Routes）を用意し、ダイアログ保存時にデータを送信します。
- Web アプリを PWA 化すると、スマートフォンのホーム画面に追加してネイティブアプリのように利用できます。更に Expo（React Native）や Capacitor を使えば App Store / Google Play への配信も可能です。

まずは静的ホスティングで「HP」として公開し、必要に応じてバックエンドや認証を追加する流れが最も手軽です。

## データ更新とマップタイル

- 世界データと都道府県のメタデータは `scripts/` 配下の Python スクリプトで生成しています。
  - `python scripts/generate_countries.py`
  - `python scripts/generate_prefectures.py`
- 市区町村の初期データは `data/japan-municipalities-sample.json` に保存されています。全市区町村を取り込む場合は同形式の JSON もしくは `code,name,prefecture` 列を持つ CSV をインポートしてください。
- 地図の描画には [MapLibre GL JS](https://maplibre.org/) を利用し、スタイルは `https://demotiles.maplibre.org/style.json` を参照しています。
- 都道府県・市区町村ポリゴンは国土地理院の GeoJSON 公開データを直接取得しています（ネットワークアクセスが必要です）。

## ライセンス

プロジェクトのソースコードは MIT ライセンスです。収録データの元となる ISO コードおよびタイムゾーンデータはそれぞれのライセンスに従います。
