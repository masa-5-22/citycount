# Citycount 到達指数ダッシュボード

ブラウザで開くだけで利用できる、世界の国・日本の都道府県・日本の市区町村の旅行接触度（0〜10 点）を記録するツールです。地図や一覧から地域を選び、滞在状況を入力すると推奨スコアが自動で表示されます。

## 機能概要

- **世界**: 249 の国・地域（ISO 3166-1 基準）を収録。MapLibre GL ベースの世界地図で国境ポリゴンをスコアに応じた色で塗り分け、クリックすると入力ダイアログが開きます。
- **日本の都道府県**: MapLibre 上で都道府県境界ポリゴンを読み込み、スコアを 0〜10 のグラデーションで表示。地図と一覧のどちらからでも編集できます。
- **日本の市区町村**: 国土地理院の市区町村ポリゴンを参照して描画。サンプル 60 件に加えて CSV/JSON インポートで拡張でき、地図上をクリックすると該当自治体を自動認識して編集ダイアログを開きます。
- **スコア判定支援**: yearsLived や totalNights などを入力すると推奨スコアを即座に計算。最終スコアは 0〜10 の整数で上書きできます。
- **永続化**: 入力内容はブラウザの `localStorage` に自動保存され、次回以降も引き継がれます。
- **CSV エクスポート**: 各セクションごとに CSV を出力可能。滞在日数やメモも一緒に出力されます。

## 使い方

1. プロジェクトをクローン/ダウンロードし、`index.html` をブラウザで開きます。
2. 上部タブから「世界」「日本の都道府県」「日本の市区町村」を切り替えられます。
3. マップ上の領域（国・都道府県・市区町村）または一覧行をクリック/Enter キーで編集ダイアログを開きます。
4. ダイアログで滞在実績を入力すると推奨スコアが表示されます。内容を確認し「保存」を押してください。
5. 右上の「CSV エクスポート」で現在のスコアをダウンロードできます。
6. 市区町村を追加する場合は地図上をクリックするか、CSV/JSON をインポートしてください（クリック時は最寄りポリゴンから自治体を推定します）。

## データ更新とマップタイル

- 世界データと都道府県のメタデータは `scripts/` 配下の Python スクリプトで生成しています。
  - `python scripts/generate_countries.py`
  - `python scripts/generate_prefectures.py`
- 市区町村の初期データは `data/japan-municipalities-sample.json` に保存されています。全市区町村を取り込む場合は同形式の JSON もしくは `code,name,prefecture` 列を持つ CSV をインポートしてください。
- 地図の描画には [MapLibre GL JS](https://maplibre.org/) を利用し、スタイルは `https://demotiles.maplibre.org/style.json` を参照しています。
- 都道府県・市区町村ポリゴンは国土地理院の GeoJSON 公開データを直接取得しています（ネットワークアクセスが必要です）。

## ライセンス

プロジェクトのソースコードは MIT ライセンスです。収録データの元となる ISO コードおよびタイムゾーンデータはそれぞれのライセンスに従います。
